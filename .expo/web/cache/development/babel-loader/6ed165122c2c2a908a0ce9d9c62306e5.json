{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/aichibaseball/training-management-app/src/screens/FoodManagementScreen.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport FoodList from \"../components/FoodList\";\nimport CircleButton from \"../elements/CircleButton\";\nimport firebase from \"firebase\";\nimport { Calendar } from 'react-native-calendars';\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: \"#FFFDF6\",\n    width: \"100%\"\n  }\n});\n\nvar older = function older(a, b) {\n  return a.date.seconds - b.date.seconds;\n};\n\nvar FoodManagementScreen = function FoodManagementScreen(props) {\n  dateToString = function dateToString(date) {\n    var str = date.toDate().toISOString();\n    return str.split(\"T\")[0];\n  };\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      foodData = _useState2[0],\n      setFoodData = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      kcalList = _useState4[0],\n      setKcalList = _useState4[1];\n\n  var _useState5 = useState(new Date().toISOString().split(\"T\")[0]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      currentDay = _useState6[0],\n      setCurrentDay = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      requiredKcal = _useState8[0],\n      setRequiredKcal = _useState8[1];\n\n  useEffect(function () {\n    var _firebase$auth = firebase.auth(),\n        currentUser = _firebase$auth.currentUser;\n\n    var db = firebase.firestore();\n    db.collection(\"users/\" + currentUser.uid + \"/food\").onSnapshot(function (querySnapshot) {\n      var foodData = [];\n      querySnapshot.forEach(function (doc) {\n        foodData.push(_objectSpread({}, doc.data(), {\n          key: doc.id\n        }));\n      });\n      setFoodData(foodData);\n      var sortedKcalData = [].concat(foodData).sort(older);\n\n      for (var i = 0; i < sortedKcalData.length; i++) {\n        if (i === 0) {\n          kcalList.push({\n            kcal: parseFloat(sortedKcalData[0].kcal),\n            date: dateToString(sortedKcalData[0].date)\n          });\n        } else {\n          if (dateToString(sortedKcalData[i].date) === dateToString(sortedKcalData[i - 1].date)) {\n            kcalList[kcalList.length - 1].kcal += parseFloat(sortedKcalData[i].kcal);\n          } else {\n            kcalList.push({\n              kcal: parseFloat(sortedKcalData[i].kcal),\n              date: dateToString(sortedKcalData[i].date)\n            });\n          }\n        }\n      }\n\n      if (kcalList.length == 0) {\n        setKcalList();\n      } else {\n        setKcalList(kcalList);\n      }\n    });\n    db.collection(\"users/\" + currentUser.uid + \"/personalData\").onSnapshot(function (querySnapshot) {\n      var personalData = [];\n      querySnapshot.forEach(function (doc) {\n        personalData.push(_objectSpread({}, doc.data(), {\n          key: doc.id\n        }));\n      });\n      setRequiredKcal(personalData[0].requiredKcal);\n    });\n  }, []);\n  var todayFoodList = foodData.filter(function (item, index) {\n    if (dateToString(item.date) === currentDay) {\n      return true;\n    }\n  });\n\n  var todaysFoodData = _toConsumableArray(todayFoodList).sort(older);\n\n  var markedDays = [0];\n  kcalList.forEach(function (i) {\n    if (requiredKcal - i.kcal >= 0) {\n      markedDays.push({\n        date: i.date,\n        dot: {\n          dots: [{\n            color: \"green\"\n          }]\n        }\n      });\n    } else if (requiredKcal - i.kcal < 0) {\n      markedDays.push({\n        date: i.date,\n        dot: {\n          dots: [{\n            color: \"red\"\n          }]\n        }\n      });\n    }\n  });\n  var dotDays = Object.assign.apply(Object, _toConsumableArray(markedDays.map(function (item) {\n    return _defineProperty({}, item.date, item.dot);\n  })));\n\n  var markedDates = _objectSpread({}, dotDays, _defineProperty({}, currentDay, {\n    selected: true,\n    selectedColor: \"#ffa500\"\n  }));\n\n  return React.createElement(View, {\n    style: styles.container,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }\n  }, React.createElement(Calendar, {\n    onDayPress: function onDayPress(day) {\n      setCurrentDay(day.dateString);\n    },\n    style: {\n      borderWidth: 1,\n      borderColor: \"black\",\n      height: 350,\n      width: \"100%\"\n    },\n    markedDates: markedDates,\n    markingType: 'multi-dot',\n    theme: {\n      'stylesheet.calendar.header': {\n        week: {\n          marginTop: 0,\n          flexDirection: 'row',\n          justifyContent: \"space-between\"\n        }\n      }\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 11\n    }\n  }), React.createElement(FoodList, {\n    foodData: todaysFoodData,\n    navigation: props.navigation,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 11\n    }\n  }), React.createElement(CircleButton, {\n    name: \"plus\",\n    onPress: function onPress() {\n      return props.navigation.navigate(\"FoodAdd\");\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default FoodManagementScreen;","map":{"version":3,"sources":["/Users/aichibaseball/training-management-app/src/screens/FoodManagementScreen.js"],"names":["React","useState","useEffect","FoodList","CircleButton","firebase","Calendar","styles","StyleSheet","create","container","flex","alignItems","justifyContent","backgroundColor","width","older","a","b","date","seconds","FoodManagementScreen","props","dateToString","str","toDate","toISOString","split","foodData","setFoodData","kcalList","setKcalList","Date","currentDay","setCurrentDay","requiredKcal","setRequiredKcal","auth","currentUser","db","firestore","collection","uid","onSnapshot","querySnapshot","forEach","doc","push","data","key","id","sortedKcalData","sort","i","length","kcal","parseFloat","personalData","todayFoodList","filter","item","index","todaysFoodData","markedDays","dot","dots","color","dotDays","Object","assign","map","markedDates","selected","selectedColor","day","dateString","borderWidth","borderColor","height","week","marginTop","flexDirection","navigation","navigate"],"mappings":"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","sourcesContent":["import React ,{useState,useEffect}from 'react';\nimport { StyleSheet, View,} from 'react-native';\nimport FoodList from \"../components/FoodList\"\nimport CircleButton from \"../elements/CircleButton\"\nimport firebase from \"firebase\"\nimport {Calendar} from 'react-native-calendars'\n\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: \"#FFFDF6\",\n    width: \"100%\"\n  },\n  \n});\nconst older = ((a,b)=>(a.date.seconds - b.date.seconds))\n\n\nconst  FoodManagementScreen = (props)=> {\n  \n  dateToString = (date)=>{\n    const str = date.toDate().toISOString();\n    return str.split(\"T\")[0]\n  }\n  const [foodData,setFoodData] = useState([])\n  const [kcalList,setKcalList] = useState([])\n  const [currentDay,setCurrentDay] = useState(new Date().toISOString().split(\"T\")[0],)\n  const [requiredKcal,setRequiredKcal] = useState([])\n  \n  \n  useEffect(()=>{\n    const {currentUser} = firebase.auth();\n    const db =firebase.firestore()\n\n    db.collection(`users/${currentUser.uid}/food`)\n    .onSnapshot((querySnapshot)=>{\n      const foodData =[];\n      //firebaseから食事データを取得\n      querySnapshot.forEach((doc)=>{\n        foodData.push({...doc.data(),key: doc.id})\n      })\n      setFoodData(foodData)\n      const sortedKcalData = [...foodData].sort(older)\n      for(let i = 0; i < sortedKcalData.length ; i++){\n        if(i === 0){\n          kcalList.push(\n          {kcal:parseFloat(sortedKcalData[0].kcal),\n            date:dateToString(sortedKcalData[0].date)})\n        }else{\n          if(dateToString(sortedKcalData[i].date) === dateToString(sortedKcalData[i -1].date)){\n            kcalList[kcalList.length-1].kcal += parseFloat(sortedKcalData[i].kcal)\n          }else{\n            kcalList.push({kcal:parseFloat(sortedKcalData[i].kcal),date:dateToString(sortedKcalData[i].date)})\n            }\n        }\n      }\n\n      if(kcalList.length == 0){\n        setKcalList()\n      }else{\n        setKcalList(kcalList)\n      }\n    })\n    \n   db.collection(`users/${currentUser.uid}/personalData`)\n   .onSnapshot((querySnapshot)=>{\n      const personalData = []\n      querySnapshot.forEach((doc)=>{\n        personalData.push({...doc.data(),key: doc.id})\n      })\n      setRequiredKcal(personalData[0].requiredKcal)\n    })\n   },[])\n\n    const todayFoodList = foodData.filter((item,index,)=>{\n      if (dateToString(item.date) === currentDay){\n        return true\n          }\n    })\n\n    const todaysFoodData = [...todayFoodList].sort(older)\n\n    const markedDays = [0]\n    kcalList.forEach((i)=>{\n      if(requiredKcal - i.kcal >= 0){\n        markedDays.push({\n          date:i.date,\n          dot:{dots:[{color:\"green\"}]}\n        })\n      }else if(requiredKcal - i.kcal < 0){\n        markedDays.push({\n          date:i.date,\n          dot:{dots:[{color:\"red\"}]}\n        })\n      }\n    })\n    const dotDays = Object.assign(...markedDays.map(item => ({ [item.date]: item.dot })))\n    const markedDates = {...dotDays,[currentDay]:{selected:true,selectedColor:\"#ffa500\"}}\n\n    \n\n\n    return (\n      <View style={styles.container}>\n          <Calendar \n          onDayPress = {((day)=>{setCurrentDay(day.dateString)})}\n          style={{\n            borderWidth:1,\n            borderColor: \"black\",\n            height: 350,\n            width:\"100%\",\n          }}\n          markedDates = {\n            markedDates\n         }\n         markingType={'multi-dot'}\n         theme={{\n          'stylesheet.calendar.header': {\n            week: {\n              marginTop: 0,\n              flexDirection: 'row',\n              justifyContent: \"space-between\"\n            }\n          }\n        }}\n        />\n          <FoodList \n            foodData={todaysFoodData}\n            navigation={props.navigation}/>\n        <CircleButton name={\"plus\"} onPress={()=>props.navigation.navigate(\"FoodAdd\")}/>\n      </View>\n    ); \n  \n}\n\nexport default FoodManagementScreen"]},"metadata":{},"sourceType":"module"}